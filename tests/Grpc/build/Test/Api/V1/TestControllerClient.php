<?php

/**
 * This code was auto-generated by the prototype/compiler@dev.
 * Do not edit this file manually.
 */

declare(strict_types=1);

namespace Test\Api\V1;

use Amp\Cancellation;
use Amp\NullCancellation;
use Prototype\Grpc\Client\Client;
use Prototype\Grpc\Client\GrpcRequest;
use Prototype\Grpc\Client\RequestException;
use Prototype\Grpc\StatusCode;

/**
 * @api
 */
final class TestControllerClient
{
    public function __construct(
        private readonly Client $client,
    ) {
    }

    /**
     * @throws RequestException
     */
    public function addTask(
        AddTaskRequest $request,
        Cancellation $cancellation = new NullCancellation(),
    ): AddTaskResponse {
        $response = $this->client->invoke(
            new GrpcRequest('/test.api.v1.TestController/AddTask', $request, AddTaskResponse::class),
            $cancellation,
        );

        if (StatusCode::OK !== $response->statusCode) {
            throw new RequestException($response->statusCode, $response->grpcMessage);
        }

        return $response->message;
    }
}
